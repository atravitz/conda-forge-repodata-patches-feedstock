# fix nanobind-abi constraint in nanobind 2.6-2.8
if:
  name: nanobind
  timestamp_lt: 17593549740000
  version_ge: 2.6.0
then:
  - replace_constrains:
      old: nanobind-abi ==15
      new: nanobind-abi ==16
---
# make nanobind-abi 15 incompatible with nanobind < 2.4 which lacks constraint on nanobind-abi
if:
  name: nanobind-abi
  timestamp_lt: 17593549740000
then:
  - add_constrains: "nanobind >=2.4"
---
# patch packages with incorrect nanobind-abi 15 pinning
# This isn't correct in principle,
# but all packages that depend on nanobind-abi 15 happen to actually have been built with nanobind-abi 16
if:
  timestamp_lt: 17593549740000
  has_depends: nanobind-abi ==15
then:
  - replace_depends:
      old: nanobind-abi ==15
      new: nanobind-abi ==16
